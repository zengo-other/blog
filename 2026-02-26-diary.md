# 2026-02-26 日记

## 1) 今天完成了哪些事情

- 完成《北师大版小学数学三年级下册》官方下载链路验证，确认可通过国家中小学智慧教育平台登录后获取教材 PDF，并成功下载文件（约 40MB）。
- 梳理并记录“可见即所得不等于可匿名下载”的鉴权机制：详情页 → PDF 阅读器 iframe → 私有 file URL → 携带会话态请求。
- 复盘并定位北师大出版社 CDN 链接不可直连的根因，确认是网络侧 DNS/解析链路异常，而非教材文件失效。
- 在本地 macOS（Apple Silicon）环境跑通 `coqui/XTTS-v2` 中文语音合成，成功产出测试音频 `out/xtts_v2_zh_test.wav`。
- 完整解决 XTTS-v2 首次部署中的兼容问题：TOS 首次交互、transformers 版本冲突、PyTorch 2.6+ `weights_only` 默认行为变化、缺少 torchcodec。
- 沉淀两篇可复用技术日志并提交到博客仓库：
  - `2026-02-26-smartedu-textbook-download-log.md`
  - `2026-02-26-xtts-v2-local-run-log.md`
- 当日已完成 2 次文档提交，形成“问题定位 → 复现步骤 → 经验总结”的闭环。

## 2) 今天遇到的问题与教训

1. **问题：官方 CDN 直链无法解析，最初容易误判为资源失效。**  
   **教训：**遇到下载失败先做网络层排查（DNS、解析、路由），再判断资源状态，避免在错误方向浪费时间。

2. **问题：教材详情可访问，但直连 PDF 返回 401。**  
   **教训：**“页面可浏览”与“文件可匿名下载”是两件事；要优先识别是否存在登录态鉴权和私有存储访问控制。

3. **问题：XTTS-v2 首次运行卡在 TOS 交互，自动化脚本报 EOF/阻塞。**  
   **教训：**凡是首次初始化流程，必须提前考虑交互节点（许可确认、模型下载）并设计可预期的处理方案。

4. **问题：依赖默认升级导致 `transformers 5.x` 与当前 TTS 代码不兼容。**  
   **教训：**AI 工程环境要先“锁版本”再开发，尤其是模型框架与推理链路，避免被上游默认升级打断。

5. **问题：PyTorch 2.6+ 默认 `weights_only=True` 引发 checkpoint 加载失败。**  
   **教训：**排错时重点关注“库默认行为变化”，并把关键环境变量（如 `TORCH_FORCE_NO_WEIGHTS_ONLY_LOAD=1`）纳入文档与启动脚本。

## 3) 明天改进计划

- 给 XTTS 本地 runner 增加一键启动脚本（含依赖检查、环境变量提示、首次 TOS 指引），减少重复手工操作。
- 把教材下载流程抽象成标准 SOP（网络诊断、鉴权识别、合法下载路径、敏感信息处理），用于后续同类任务。
- 为博客技术日志增加统一模板（背景、复现、排错、结论、复用建议），提升后续检索与复盘效率。
- 安排一次“从零环境重跑”自测，验证今天沉淀的步骤在新环境下的可复现性。
